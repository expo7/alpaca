### Project Context

You are working in my full-stack trading project located at `~/Desktop/alpaca`.

Repo layout:

- ./stockscores/        ‚Üí Django backend
  - Paper trading engine
  - Strategies, orders, portfolios, leaderboards, alerts
  - Celery workers + beat
  - Strategy execution wired via:
    - StrategyViewSet.execute
    - execute_strategy_task in stockscores/paper/tasks.py
    - StrategyRunner.evaluate per portfolio
- ./rank-ui/            ‚Üí React + Vite frontend
  - Uses React Router, hooks, and API calls into the Django backend
  - UI pages: StrategyBuilder, Orders, Leaderboards, Alerts, Backtests, Positions, Performance, Settings, Watchlists, Auth (Landing/Login), etc.
  - Tests: Vitest + React Testing Library, configured in:
    - rank-ui/package.json
    - rank-ui/vite.config.js
    - rank-ui/src/setupTests.js
    - rank-ui/src/__tests__/*.test.jsx

Infra / tooling:

- Python 3.11 (Django backend)
- Node 22.x (frontend, Vite/Vitest)
- Dockerfile and docker-compose.yml at repo root configure:
  - `web` (Django app)
  - `worker` (Celery worker)
  - `beat` (Celery beat)
  - `db` (Postgres)
  - `redis` (Redis 7)
- `.gitignore` is configured to ignore:
  - rank-ui/node_modules, rank-ui/dist, rank-ui/coverage
  - log files, build artifacts, venvs, etc.

CI:

- GitHub Actions workflow (e.g. `.github/workflows/ci.yml`) runs:
  - Backend tests: `python manage.py test` in `stockscores/`
  - Frontend tests: `npm test` (or `npm test -- --runInBand`) in `rank-ui/`

### Current State of Tests (Frontend)

Vitest + RTL tests already cover:

- Core pages:
  - StrategyBuilder (list/dry-run/execute flows)
  - Orders (queued chip, audit modal)
  - Leaderboards
  - Alerts
  - Backtests
  - Positions
  - Performance
  - Settings
  - Watchlists
- Core flows:
  - Flow_StrategyLifecycle.test.jsx
    - Authenticated user ‚Üí Strategy Builder ‚Üí dry-run ‚Üí execute ‚Üí see queued orders
  - Flow_WatchlistManagement.test.jsx
    - User opens Watchlists ‚Üí adds symbol ‚Üí removes symbol
  - Flow_AlertsReview.test.jsx
    - User opens Alerts ‚Üí opens alert details/history ‚Üí closes
- Supporting pieces:
  - App routing + auth (App.test.jsx, Auth.test.jsx)
  - Navbar navigation (Navbar.test.jsx)
  - useQuotes hook (useQuotes.test.jsx)
  - Alerts behavior (loading/empty/error states, key fields)
  - Performance page feeding mock metrics/snapshots/movements, asserting totals/returns/cash movements without NaNs

Coverage is roughly:
- ~64% overall statements/lines
- Much higher on critical pages (Leaderboards, Settings, Watchlists, Performance, etc.)

### How You Should Work (General Behavior)

From now on, for THIS REPO ONLY, follow these rules:

1. Respect existing structure and patterns.
   - For backend: follow existing Django app layout, serializers, viewsets, Celery tasks, and tests.
   - For frontend: follow existing React + Vite + hooks patterns and Testing Library style.

2. Prefer small, incremental changes.
   - Modify only what is necessary.
   - Keep code diff and test diff closely related.

3. Keep things deterministic.
   - Avoid introducing flakiness in tests (no random timers, no uncontrolled async side-effects).
   - Use environment-agnostic behavior where possible (no hard-coded local paths, etc.).

4. Be explicit about files.
   - When you propose changes, always name the exact files and show full updated versions or focused patches so I can copy/paste.

### üîí Standing Rules for Testing (Always Active)

These rules apply to **every change you make** going forward:

1. **Tests MUST accompany code changes.**
   - If you create or modify frontend code (components, pages, hooks, API utils, routing, etc.), you MUST also:
     - Create or update relevant Vitest + RTL tests under `rank-ui/src/__tests__/`.
   - If you alter backend logic (viewsets, serializers, tasks, models), you MUST:
     - Create or update Django tests (or pytest-style tests) under the appropriate tests module.

2. **Never leave newly-added logic untested.**
   - Any new function, hook, component, endpoint, or flow you introduce must have at least one meaningful test.
   - ‚ÄúMeaningful‚Äù = asserts behavior and visible output, not just trivial existence.

3. **Maintain or increase coverage.**
   - Do not reduce coverage for key pages/hooks/components.
   - If a refactor simplifies logic and makes some tests redundant, you may update them, but coverage should stay at least roughly stable or improve.

4. **Fix or update tests instead of deleting them.**
   - If a test fails due to a code change, update the test or mocks so it aligns with the new behavior.
   - Do not remove or comment out tests unless explicitly instructed.

5. **Full-flow changes require full-flow tests.**
   - If you change a flow that spans pages (e.g. strategy execution, order placement, alerts drill-down, watchlist management), you must:
     - Update or add flow tests in `rank-ui/src/__tests__/Flow_*.test.jsx` that cover the end-to-end behavior from the user‚Äôs perspective.

6. **Testing style guidelines (Frontend):**
   - Use React Testing Library best practices:
     - Prefer `getByRole`, `getByText`, `getByLabelText`, etc.
     - Avoid brittle selectors (like `.className`) when possible.
   - Use `async/await` and `waitFor` for async UI updates.
   - Don‚Äôt use huge snapshots; assert specific behaviors and UI text.
   - Mock APIs at a sensible boundary (e.g. fetch/axios wrapper or API module) instead of mocking deep internals.

7. **Testing style guidelines (Backend):**
   - Prefer testing visible behavior (API responses, side effects) over implementation details.
   - For Celery tasks, test:
     - Correct scheduling/enqueue behavior.
     - Correct side effects on models or external systems.

### What I Might Ask You To Do

In this repo, I may ask you to:

- Extend or tweak the **paper trading engine**, strategy execution, caps, and metrics.
- Add or modify **API endpoints** for paper trading, backtests, orders, alerts, and leaderboards.
- Add new **frontend features** (e.g., new panels, filters, charts, tabs).
- Improve or fix **frontend/ backend tests**.
- Adjust **Docker / docker-compose** for deployment or local dev.
- Work with **CI** (GitHub Actions) to run tests and enforce quality gates.

For every such request:

- **Follow the standing testing rules above.**
- Keep tests updated and passing.
- Tell me what files changed and why.
- If something is ambiguous, choose a reasonable, minimal approach consistent with the current code.

### Initial Acknowledgment

Acknowledge this context and these rules, then wait for my specific request. Do NOT start changing files until I ask for a concrete task (for example, ‚Äúadd X feature‚Äù, ‚Äúfix Y bug‚Äù, or ‚Äúrefactor Z component/endpoint‚Äù).
